<!-- Container to align with job dashboard -->
<div class="2xl:max-w-[82rem] mx-auto 2xl:px-4 xl:px-[66px] ml-4">
  <!-- Page Title and Subtitle -->
  <div class="p-6">
    <h1 class="text-2xl font-semibold mb-1">Subscription Services</h1>
    <p class="text-gray-500 mb-6">Set up your bdjobs recruiter presence and hiring needs.</p>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <span class="ml-2 text-gray-600">Loading service history...</span>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <strong>Error:</strong> {{ error }}
      <button (click)="loadServiceHistory()" class="ml-2 text-blue-600 hover:underline">Retry</button>
    </div>

    <!-- Content when data is loaded -->
    <div *ngIf="!loading && !error && serviceData">
      <!-- Tabs -->
      <div class="flex space-x-2 mb-4">
        <button 
          (click)="setActiveTab('all')"
          [class]="activeTab === 'all' ? 'px-4 py-2 rounded-t bg-white border-b-2 border-blue-600 font-medium text-blue-600' : 'px-4 py-2 rounded-t bg-blue-50 border-b-2 border-transparent font-medium text-gray-600'"
          class="flex items-center gap-2"
        >
          All <span class="bg-blue-600 text-white text-xs rounded-full px-2 py-0.5">{{ getTabCount('all') }}</span>
        </button>
        <button 
          (click)="setActiveTab('cm')"
          [class]="activeTab === 'cm' ? 'px-4 py-2 rounded-t bg-white border-b-2 border-blue-600 font-medium text-blue-600' : 'px-4 py-2 rounded-t bg-blue-50 border-b-2 border-transparent font-medium text-gray-600'"
          class="flex items-center gap-2"
        >
          CM Package Access <span class="bg-gray-200 text-gray-600 text-xs rounded-full px-2 py-0.5">{{ getTabCount('cm') }}</span>
        </button>
        <button 
          (click)="setActiveTab('job')"
          [class]="activeTab === 'job' ? 'px-4 py-2 rounded-t bg-white border-b-2 border-blue-600 font-medium text-blue-600' : 'px-4 py-2 rounded-t bg-blue-50 border-b-2 border-transparent font-medium text-gray-600'"
          class="flex items-center gap-2"
        >
          Job Posting Access <span class="bg-gray-200 text-gray-600 text-xs rounded-full px-2 py-0.5">{{ getTabCount('job') }}</span>
        </button>
        <button 
          (click)="setActiveTab('sms')"
          [class]="activeTab === 'sms' ? 'px-4 py-2 rounded-t bg-white border-b-2 border-blue-600 font-medium text-blue-600' : 'px-4 py-2 rounded-t bg-blue-50 border-b-2 border-transparent font-medium text-gray-600'"
          class="flex items-center gap-2"
        >
          SMS Package Access <span class="bg-gray-200 text-gray-600 text-xs rounded-full px-2 py-0.5">{{ getTabCount('sms') }}</span>
        </button>
        <button 
          (click)="setActiveTab('cv')"
          [class]="activeTab === 'cv' ? 'px-4 py-2 rounded-t bg-white border-b-2 border-blue-600 font-medium text-blue-600' : 'px-4 py-2 rounded-t bg-blue-50 border-b-2 border-transparent font-medium text-gray-600'"
          class="flex items-center gap-2"
        >
          CV Bank Access <span class="bg-gray-200 text-gray-600 text-xs rounded-full px-2 py-0.5">{{ getTabCount('cv') }}</span>
        </button>
      </div>

      <!-- Filters and Print -->
      <div class="flex items-center justify-between mb-4">
        <div></div>
        <div class="flex items-center gap-2">
          <button class="flex items-center gap-1 text-gray-600 hover:text-blue-600 text-sm">
            <span class="icon icon-print"></span>
            Print
          </button>
          <button
            class="border rounded px-3 py-1 text-sm flex items-center gap-2"
            (click)="openDatePicker()"
          >
            {{ startDate && endDate ? (startDate | date:'shortDate') + ' – ' + (endDate | date:'shortDate') : 'Start date – End date' }}
          </button>
          <button
            *ngIf="startDate && endDate"
            class="text-red-600 hover:text-red-800 text-sm"
            (click)="clearDateFilters()"
          >
            Clear
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="overflow-x-auto bg-white rounded shadow">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-200">
            <tr>
              <th class="px-4 py-2 text-left font-medium text-black">SL</th>
              <th class="px-4 py-2 text-left font-medium text-black">Service Name</th>
              <th class="px-4 py-2 text-left font-medium text-black">Usage</th>
              <th class="px-4 py-2 text-left font-medium text-black">Expire Date</th>
              <th class="px-4 py-2 text-left font-medium text-black">Subscription Duration</th>
              <th class="px-4 py-2 text-left font-medium text-black">Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamic Rows -->
            <tr *ngFor="let item of getPaginatedData(); let i = index" class="border-b">
              <td class="px-4 py-2">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
              <td class="px-4 py-2 flex items-center gap-2">
                {{ item.serviceName }}
                <span 
                  [class]="item.status === 'Active' ? 'ml-2 bg-green-100 text-green-700 text-xs font-semibold px-2 py-0.5 rounded' : 'ml-2 bg-gray-200 text-gray-500 text-xs font-semibold px-2 py-0.5 rounded'"
                >
                  {{ item.status }}
                </span>
              </td>
              <td class="px-4 py-2">
                <div>{{ item.usage }}</div>
                <div *ngIf="item.jobAdsUsed && item.jobAdsTotal" class="text-xs text-gray-400">
                  {{ item.jobAdsUsed }}/{{ item.jobAdsTotal }} Job Ads
                </div>
                <div *ngIf="item.cvsUsed && item.cvsTotal" class="text-xs text-gray-400">
                  {{ item.cvsUsed }}/{{ item.cvsTotal }} CVs
                </div>
              </td>
              <td class="px-4 py-2">{{ item.subscriptionDuration }}</td>
              <td class="px-4 py-2">{{ item.expireDate }}</td>
              <td class="px-4 py-2">
                <a href="#" class="text-blue-600 hover:underline">Details</a>
              </td>
            </tr>
            
            <!-- Empty State -->
            <tr *ngIf="getPaginatedData().length === 0">
              <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                No services found for this category.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="getTotalPages() > 1" class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-500">Page {{ currentPage }} of {{ getTotalPages() }}</div>
        <div class="flex items-center gap-1">
          <button 
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="px-2 py-1 rounded border text-gray-500 bg-white disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Previous
          </button>
          
          <!-- Page Numbers -->
          <ng-container *ngFor="let page of getPageNumbers()">
            <button 
              *ngIf="page !== '...'"
              (click)="navigateToPage(page)"
              [class]="page === currentPage ? 'px-2 py-1 rounded border bg-blue-600 text-white' : 'px-2 py-1 rounded border bg-white text-gray-700'"
            >
              {{ page }}
            </button>
            <span *ngIf="page === '...'" class="px-2">...</span>
          </ng-container>
          
          <button 
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === getTotalPages()"
            class="px-2 py-1 rounded border text-gray-500 bg-white disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Date Range Picker Modal -->
<app-date-range-picker-modal
  *ngIf="showDatePicker"
  [initialStartDate]="startDate"
  [initialEndDate]="endDate"
  (apply)="onDateRangeApply($event)"
  (cancel)="closeDatePicker()"
></app-date-range-picker-modal>
